id: ncjt_rx_sync
label: Rx Sync
category: '[dMIMO]'

templates:
  imports: from gnuradio import ncjt
  make: ncjt.rx_sync(${nchans}, ${p1rx}, ${preamblelen}, ${dataframelen}, ${samplerate}, ${pktspersec}, ${p2rx}, ${hwdelayp2}, ${p2preamblelen}, ${p2framelen}, ${p2start}, ${p3rx}, ${hwdelayp3}, ${p3preamblelen}, ${p3framelen}, ${p3start}, ${rxpwrthrd}, ${acorrthrd}, ${xcorrthrd}, ${maxcorrlen}, ${lltf2}, ${debug})

parameters:
  - id: nchans
    label: Number of Channels
    dtype: int
    default: 1
    options: [ 1, 2, 3, 4, 5, 6, 7, 8 ]
    hide: part
  - id: p1rx
    label: P1 Rx
    dtype: bool
    default: 'True'
    options: [ 'True', 'False' ]
    option_labels: [ Enable, Disable ]
  - id: preamblelen
    label: Preamble Length
    dtype: int
    default: '400'
  - id: dataframelen
    label: DataFrame Length
    dtype: int
  - id: samplerate
    label: Sample Rate
    dtype: real
    default: '10e6'
    hide: part
  - id: pktspersec
    label: Packets/Sec
    dtype: int
    default: '8'
  - id: p2rx
    label: P2 Rx
    dtype: bool
    default: 'False'
    options: [ 'True', 'False' ]
    option_labels: [ Enable, Disable ]
    hide: part
  - id: hwdelayp2
    label: HW Delay (P2)
    dtype: int
    default: '0'
    hide: part
  - id: p2preamblelen
    label: P2 Preamble Length
    dtype: int
    default: '0'
    hide: part
  - id: p2framelen
    label: P2 DataFrame Length
    dtype: int
    default: '0'
    hide: part
  - id: p2start
    label: P2 Start Time
    dtype: float
    default: '0'
    hide: part
  - id: p3rx
    label: P3 Rx
    dtype: bool
    default: 'False'
    options: [ 'True', 'False' ]
    option_labels: [ Enable, Disable ]
    hide: part
  - id: hwdelayp3
    label: HW Delay (P3)
    dtype: int
    default: '0'
    hide: part
  - id: p3preamblelen
    label: P3 Preamble Length
    dtype: int
    default: '0'
    hide: part
  - id: p3framelen
    label: P3 DataFrame Length
    dtype: int
    default: '0'
    hide: part
  - id: p3start
    label: P3 Start Time
    dtype: float
    default: '0'
    hide: part
  - id: rxpwrthrd
    label: Signal Power Threshold
    dtype: float
    default: '5e-4'
  - id: acorrthrd
    label: Search Threshold
    dtype: float
    default: '0.6'
  - id: xcorrthrd
    label: Xcorr Threshold
    dtype: float
    default: '0.5'
  - id: maxcorrlen
    label: Search Window
    dtype: int
    default: '4000'
    hide: part
  - id: lltf2
    label: Use LLTF v2
    dtype: bool
    default: 'False'
    options: [ 'True', 'False' ]
    option_labels: [ Enable, Disable ]
    hide: part
  - id: debug
    label: Debug
    dtype: bool
    default: 'False'
    options: [ 'True', 'False' ]
    option_labels: [ Enable, Disable ]
    hide: part

inputs:
  - label: in
    domain: stream
    dtype: complex
    multiplicity: ${nchans}

outputs:
  - label: out1
    domain: stream
    dtype: complex
    multiplicity: ${nchans}
    hide: ${not p1rx}
  - label: out2
    domain: stream
    dtype: complex
    multiplicity: ${nchans}
    optional: true
    hide: ${not p2rx}
  - label: out3
    domain: stream
    dtype: complex
    multiplicity: ${nchans}
    optional: true
    hide: ${not p3rx}
  - label: uhdcmd
    domain: message
    optional: true
  - label: rxrdy
    domain: message
    optional: true
  - label: rxtime
    domain: message
    optional: true

asserts:
  - ${ dataframelen > 0 }
  - ${ dataframelen > 0 }
  - ${ pktspersec >= 1 and pktspersec <= 100 }

file_format: 1
